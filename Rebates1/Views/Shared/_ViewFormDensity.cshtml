@model List<Rebates1.Models.RebatesViewModel>

@{
    Layout = "_Layout";
}

@{
    var RebateNo = TempData["RebateNo"];
    var Rebatetype = TempData["RebateType"];
    var Status = TempData["Status"];
    var AccountNumber = TempData["AccountNumber"];
    var IDNumber = TempData["IDNumber"];
    var PassportNumber = TempData["PassportNumber"];
    var Gender = TempData["Gender"];
    var MaritalStatus = TempData["MaritalStatus"];
    var Surname = TempData["Surname"];
    var FirstNames = TempData["FirstNames"];
    var StreetAddress = TempData["StreetAddress"];
    var CitySuburb = TempData["CitySuburb"];
    var PostalCode = TempData["PostalCode"];
    var PostalAddress = TempData["PostalAddress"];
    var PostalAddressCitySuburb = TempData["PostalAddressCitySuburb"];
    var PostalAddressPostalCode = TempData["PostalAddressPostalCode"];
    var HomeTel = TempData["HomeTel"];
    var CellNo = TempData["CellNo"];
    var WorkTel = TempData["WorkTel"];
    var Email = TempData["Email"];
    var AccountNo_MultipleUnits = TempData["AccountNo_MultipleUnits"];
    var Contact_CellNo = TempData["Contact_CellNo"];
    var SchemeBuilding = TempData["SchemeBuilding"];
    var Role = TempData["currentRole"];

    TempData.Keep("RebateNo");
    TempData.Keep("RebateType");
    TempData.Keep("Status");
    TempData.Keep("AccountNumber");
    TempData.Keep("IdentityNumber");
    TempData.Keep("PassportNumber");
    TempData.Keep("Gender");
    TempData.Keep("MaritalStatus");
    TempData.Keep("Surname");
    TempData.Keep("StreetAddress");
    TempData.Keep("CitySuburb");
    TempData.Keep("PostalCode");
    TempData.Keep("PostalAddress");
    TempData.Keep("PostalAddressCitySuburb");
    TempData.Keep("PostalAddressPostalCode");
    TempData.Keep("HomeTel");
    TempData.Keep("CellNo");
    TempData.Keep("WorkTel");
    TempData.Keep("Email");
    TempData.Keep("AccountNo_MultipleUnits");
    TempData.Keep("Contact_CellNo");
    TempData.Keep("SchemeBuilding");
    TempData.Keep("currentRole");
}


<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.2/html2pdf.bundle.min.js"></script>
<br />

@if (Model != null)
{
    foreach (var item in Model)
    {
        <input hidden type="text" id="RebateNo" name="Rebate_No" value="@item.Rebate_No" />

        <form method="post" enctype="multipart/form-data" asp-controller="Acknowledge" asp-action="ApproveReject" asp-route-approval="Approved" asp-route-RebateNo="@item.Rebate_No" style="margin-left: 0px">

            <div id="section1" style="display:flex;justify-content: center;">
                <div class="div1" style=" margin-top: 12px; border-radius: 25px; border: 2px solid #C69E63; padding: 20px;width: 1050px;}">
                    <input type="hidden" name="RebateType" value="@Rebatetype" />

                    <div class="form-group">
                        <label class="control-label">Account Number</label>
                        <input class="form-control" minlength="9" maxlength="9" id="AccountNumber" value="@AccountNumber" disabled />
                    </div>

                    <div class="form-group">
                        <label class="control-label"> Gender </label>
                        <input class="form-control" value="@Gender" disabled />
                    </div>

                    <div class="form-group">
                        <label class="control-label"> Marital Status </label>
                        <input class="form-control" value="@MaritalStatus" disabled />
                    </div>

                    <div class="form-group">
                        <label class="control-label"> Surname </label>
                        <input class="form-control" id="Surname" value="@Surname" disabled />
                    </div>

                    <div class="form-group">
                        <label class="control-label"> First Names </label>
                        <input class="form-control" id="FirstNames" value="@FirstNames" disabled />
                    </div>

                    <div class="form-group" style="display: inline-block; width: 248px">
                        <label class="control-label"> RSA ID Number </label>
                        <input class="form-control" id="IDNumber" maxlength="13" value="@IDNumber" disabled />
                    </div>

                    <div class="form-group" style="display: inline-block; width: 248px">
                        <label class="control-label"> Passport Number </label>
                        <input class="form-control" id="IDNumber" maxlength="13" value="@PassportNumber" disabled />
                    </div>

                    <div class="form-group">
                        <label class="control-label"> Street Address </label>
                        <input class="form-control" id="StreetAddress" value="@StreetAddress" disabled />
                    </div>

                    <div class="form-group">
                        <label class="control-label"> City/Suburb </label>
                        <input class="form-control" id="CitySuburb" value="@CitySuburb" disabled />
                    </div>

                    <div class="form-group">
                        <label class="control-label"> Postal Code </label>
                        <input class="form-control" id="PostalCode" value="@PostalCode" disabled />
                    </div>

                    <div class="form-group">
                        <label class="control-label"> Postal Address </label>
                        <input class="form-control" value="@PostalAddress" disabled />
                    </div>

                    <div class="form-group">
                        <label class="control-label"> Postal Address City/Suburb</label>
                        <input class="form-control" value="@PostalAddressCitySuburb" disabled />
                    </div>

                    <div class="form-group">
                        <label class="control-label"> Postal Code </label>
                        <input class="form-control" value="@PostalAddressPostalCode" disabled />
                    </div>

                    <div class="form-group" style="display: inline-block; width: 248px">
                        <label class="control-label" style="display: block;"> Home Tel</label>
                        <input class="form-control" value="@HomeTel" disabled />
                    </div>

                    <div class="form-group" style="display: inline-block; width: 248px">
                        <label class="control-label" style="display: block;"> Cell No</label>
                        <input class="form-control" id="CellNo" value="@CellNo" disabled />
                    </div>

                    <div class="form-group" style="display: inline-block; width: 248px">
                        <label class="control-label" style="display: block;"> Work Tel </label>
                        <input class="form-control" value="@WorkTel" disabled />
                    </div>

                    <div class="form-group" style="display: inline-block; width: 248px">
                        <label class="control-label" style="display: block;"> Email </label>
                        <input class="form-control" id="Email" value="@Email" disabled />
                    </div>

                    <div class="form-group">
                        <label class="control-label"> Account Numbers(s) - Multiple Units </label>
                        <input class="form-control" value="@AccountNo_MultipleUnits" disabled />
                    </div>

                    <div class="form-group">
                        <label class="control-label"> Contact - Tel/Cell Number</label>
                        <input class="form-control" value="@Contact_CellNo" disabled />
                    </div>

                    <div class="form-group">
                        <label class="control-label"> Scheme Building </label>
                        <input class="form-control" value="@SchemeBuilding" disabled />
                    </div>
                </div>
            </div>

            <br />

            <div style="display:flex;justify-content: center;">
                @if (Model != null)
                {
                    foreach (var item1 in Model)
                    {
                        @if (@item.Files1 != "")
                        {
                            <div style="display: flex; justify-content: center; gap: 10px; margin-top: 20px;">
                                <button onclick="downloadForm()" class="btn btn-primary">Download Form</button>
                                <a class="btn btn-primary" asp-controller="Acknowledge" asp-action="DownloadFiles1" asp-route-RebateNo="@item.Rebate_No">Download Files</a>
                            </div>
                        }
                    }
                }
            </div>

            @if (Role != "Director")
            {
                @if (Status.ToString() == "Pending Approval")
                {
                    <div class="row">
                        <div class="col=lg-6">
                            <label for="approverComment">Comment:</label>
                            <textarea class="form-control" id="approverComment4" onchange="myFunction(this.value)" name="approverComment4" required></textarea>
                        </div>
                    </div>
                }
                else
                {
                    <div class="row">
                        <div class="col=lg-6">
                            <label for="approverComment">Comment:</label>
                            <textarea class="form-control" id="approverComment" onchange="myFunction(this.value)" name="approverComment" required></textarea>
                        </div>
                    </div>
                }
                
                <div class="row">
                    <div style="margin-top: 5%; display: flex; justify-content: center;" id="approve-reject">

                        @if (Rebatetype.ToString() == "Public Benefit Organisation Rebate" && Status.ToString() == "Pending Approval")
                        {
                            <a style="background-color: #025752; color: white; margin-right: 5px" class="btn" data-bs-target="#approveModal" data-bs-toggle="modal">Approve</a>
                        }
                        else if (Rebatetype.ToString() == "Public Benefit Organisation Rebate")
                        {
                            <a style="background-color: #025752; color: white; margin-right: 5px" class="btn" data-bs-target="#pendingModal" data-bs-toggle="modal">Approve</a>
                        }
                        else
                        {
                            <a style="background-color: #025752; color: white; margin-right: 5px" class="btn" data-bs-target="#approveModal" data-bs-toggle="modal">Approve</a>
                        }

                        <a style="background-color: red; color: white" class="btn" data-bs-target="#rejectModal" data-bs-toggle="modal">Reject</a>
                    </div>
                </div>
            }

            <div class="m-4">
                <div id="approveModal" class="modal fade" data-bs-backdrop="static" tabindex="-1">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">Confirmation</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                            </div>
                            <div class="modal-body">
                                <p>Do you want to approve this rebate?</p>
                                @*<p class="text-secondary"><small>If you don't save, your changes will be lost.</small></p>*@
                            </div>
                            <div class="modal-footer" style="display: flex; justify-content: center;">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                <button type="submit" class="btn" style="background-color: #E6B000;">Proceed</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </form>

        <form method="post" enctype="multipart/form-data" asp-controller="Acknowledge" asp-action="ApproveReject" asp-route-approval="Rejected" asp-route-RebateNo="@item.Rebate_No" style="margin-left: 0px">

            <div hidden class="row">
                <div class="col=lg-6">
                    <label for="approverComment">Comment:</label>
                    <textarea class="form-control" id="approverComment2" name="approverComment"></textarea>
                </div>
            </div>

            <input type="hidden" name="RebateType" value="@Rebatetype" />

            <input type="hidden" name="approverComment4" class="HiddenApproverComment" />

            <div class="m-4">
                <div id="rejectModal" class="modal fade" data-bs-backdrop="static" tabindex="-1">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">Confirmation</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                            </div>
                            <div class="modal-body">
                                <p>Do you want to reject this rebate?</p>
                                @*<p class="text-secondary"><small>If you don't save, your changes will be lost.</small></p>*@
                            </div>
                            <div class="modal-footer" style="display: flex; justify-content: center;">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                <button type="submit" class="btn" style="background-color: #E6B000;">Proceed</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </form>

        <form method="post" enctype="multipart/form-data" asp-controller="Acknowledge" asp-action="ApproveReject" asp-route-approval="Pending Approval" asp-route-RebateNo="@item.Rebate_No" style="margin-left: 0px" onsubmit="addCommentToForm(this)">

            <div hidden class="row">
                <div class="col=lg-6">
                    <label for="approverComment">Comment:</label>
                    <textarea class="form-control" id="approverComment3" name="approverComment"></textarea>
                </div>
            </div>

            <input type="hidden" name="RebateType" value="@Rebatetype" />            

            <div class="m-4">
                <div id="pendingModal" class="modal fade" data-bs-backdrop="static" tabindex="-1">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">Confirmation</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                            </div>
                            <div class="modal-body">
                                <p>Do you want to approve this rebate?</p>
                                @*<p class="text-secondary"><small>If you don't save, your changes will be lost.</small></p>*@
                            </div>
                            <div class="modal-footer" style="display: flex; justify-content: center;">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                <button type="submit" class="btn" style="background-color: #E6B000;">Proceed</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </form>
                
    }
}

<script>
    function downloadForm() {
        // Select the form section
        const formSection = document.getElementById('section1');

        const rebateNo = document.getElementById('RebateNo').value;

        // Use html2pdf to convert the section to a PDF
        html2pdf(formSection, {
            margin: 1,
            filename: rebateNo + '.pdf',
            image: { type: 'jpeg', quality: 0.98 },
            html2canvas: { scale: 2 },
            jsPDF: { unit: 'in', format: 'a4', orientation: 'portrait' }
        });
    }
</script>

<script>
    function myFunction(val) {
        document.getElementById("approverComment2").value = val;
        document.getElementById("approverComment3").value = val;
        document.getElementById("approverComment4").value = val;
    }
</script>

<script>
    function addCommentToForm(form) {
        // Get the value from the textarea
        var commentValue = document.getElementById('ApproverComment4').value;

        // Set the value to the hidden input inside the specific form being submitted
        form.querySelector('.HiddenApproverComment').value = commentValue;
    }
</script>

<script>
    const textarea1 = document.getElementById('approverComment');

    const preventEnterKey = function (textarea) {
        textarea.addEventListener('keydown', function (event) {
            if (event.key === 'Enter') {
                event.preventDefault();
            }
        });
    };

    preventEnterKey(textarea1);
</script>